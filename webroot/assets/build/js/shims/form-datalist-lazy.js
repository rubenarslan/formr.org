webshims.register("form-datalist-lazy",(function(t,e,i,s,a,o){var l=0,n=t.webshims.cfg.forms,p={},r=function(t){if(!t)return[];if(p[t])return p[t];var e;try{e=JSON.parse(localStorage.getItem("storedDatalistOptions"+t))}catch(t){}return p[t]=e||[],e||[]},u=/</g,d=/>/g,h=/\s*,\s*/g;e.getDataListVal=function(e){var i=t.data(e,"datalistWidget");return i?i.getPartialValue():t.prop(e,"value")},t.extend(o.shadowListProto,{_lazyCreate:function(s){var a=this;this.hideList=t.proxy(a,"hideList"),this.index=-1,this.input=s.input,this.arrayOptions=[],this._updateOptions(),this.popover=e.objectCreate(e.wsPopover,{},this.options.popover),this.shadowList=this.popover.element.addClass("datalist-polyfill"),this.shadowList.on("mouseenter.datalistWidget mousedown.datalistWidget click.datalistWidget","li",(function(e){if(!a._stopMouseOver||!e||"mouseenter"!=e.type){var i=t("li:not(.hidden-item)",a.shadowList),o="mousedown"==e.type||"click"==e.type;return o&&!1===t(s.input).getNativeElement().triggerHandler("beforeselect",[t(e.currentTarget).find(".option-value").text()])||(a.markItem(i.index(e.currentTarget),o,i),"click"==e.type&&(a.hideList(),n.customDatalist&&t(s.input).getNativeElement().trigger("datalistselect"))),"mousedown"!=e.type}})),s.input.setAttribute("autocomplete","off"),this.lastCompletedValue="",t(s.input).attr({"aria-haspopup":"true","aria-autocomplete":"both"}).on({"input.datalistWidget":function(){a.triggeredByDatalist||(a.changedValue=!1,a.showHideOptions())},"keydown.datalistWidget":function(e){var i,o,l=e.keyCode,p=!!a.options.inlineValue||"onlyScroll";if(40==l&&!a.showList())return a.markItem(a.index+1,p),!1;if(a.popover.isVisible){if(38==l)return a.markItem(a.index-1,p),!1;if(!e.shiftKey&&(33==l||36==l))return a.markItem(0,p),!1;if(!e.shiftKey&&(34==l||35==l))return o=t("li:not(.hidden-item)",a.shadowList),a.markItem(o.length-1,!0,o),!1;if(13==l||27==l){if(13==l){if(i=t("li.active-item:not(.hidden-item)",a.shadowList),a.isCompleted&&(t.prop(s.input,"selectionStart",t.prop(s.input,"value").length),a.lastCompletedValue&&!i[0]&&(a.lastCompletedValue="",a.isCompleted=!1)),!1===t(s.input).getNativeElement().triggerHandler("beforeselect",[i.find(".option-value").text()]))return;a.changeValue(i)}if(a.hideList(),n.customDatalist&&i&&i[0]&&t(s.input).getNativeElement().trigger("datalistselect"),13!=e.keyCode||i&&i[0])return!1}}},"focus.datalistWidget":function(){a.lastCompletedValue="",a.options.focus&&a.showList()},"mousedown.datalistWidget":function(){t(this).is(":focus")&&a.showList()}}),t(this.datalist).off("updateDatalist.datalistWidget").on("updateDatalist.datalistWidget",t.proxy(this,"_resetListCached")).on("remove",(function(t){t.originalEvent||a.destroy()})),this._resetListCached(),s.input.form&&(s.input.name||s.input.id)&&t(s.input.form).on("submit.datalistWidget"+s.input.id,(function(){if(!t(s.input).hasClass("no-datalist-cache")&&"off"!=a._autocomplete){var e=t.prop(s.input,"value"),i=(s.input.name||s.input.id)+t.prop(s.input,"type");a.storedOptions||(a.storedOptions=r(i)),e&&-1==a.storedOptions.indexOf(e)&&(a.storedOptions.push(e),function(t,e){if(t){e=e||[];try{localStorage.setItem("storedDatalistOptions"+t,JSON.stringify(e))}catch(t){}}}(i,a.storedOptions))}})),t(i).on("unload.datalist"+this.id+" beforeunload.datalist"+this.id,(function(t){a.destroy(t)}))},_resetListCached:function(){var e,s=this;this.needsUpdate=!0,this.lastUpdatedValue=!1,this.lastUnfoundValue="",this.updateTimer||(i.QUnit||(e=t(s.input).is(":focus")&&(s.options.focus||t.prop(s.input,"value")))?s.updateListOptions(e):s.updateTimer=setTimeout((function(){s.updateListOptions(),s=null}),200))},_updateOptions:function(){this.options=e.getOptions(this.input,"list",o.list),t(this.input).prop("multiple")&&("email"!=t(this.input).prop("type")?e.warn("multiple only used on email and file type. Use data-list-multiple instead."):this.options.multiple=!0),this.options.inlineValue||this.options.valueCompletion||(t.attr(this.input,"aria-autocomplete","list"),t.attr(this.input,"aria-expanded","false")),this.options.getOptionContent&&!t.isFunction(this.options.getOptionContent)&&(this.options.getOptionContent=!1)},updateListOptions:function(e){this.needsUpdate=!1,clearTimeout(this.updateTimer),this.updateTimer=!1;var i,s,a,o,n,p,h,c=[],m=[],g=[];for(o=0,n=(a=t.prop(this.datalist,"options")).length;n>o;o++)!(i=a[o]).disabled&&(h=t(i).val())&&((s={value:this.options.noHtmlEscape?h:h.replace(u,"&lt;").replace(d,"&gt;"),label:t.trim(t.attr(i,"label"))||"",className:i.className||"",elem:i}).label&&(s.className+=" has-option-label"),m.push(s.value),g.push(s));for(this.storedOptions||(this.storedOptions=t(this.input).hasClass("no-datalist-cache")||"off"==this._autocomplete?[]:r((this.input.name||this.input.id)+t.prop(this.input,"type"))),this.storedOptions.forEach((function(t){-1==m.indexOf(t)&&g.push({value:t,label:"",className:"stored-suggest",style:""})})),o=0,n=g.length;n>o;o++)p=g[o],c[o]='<li class="'+p.className+'" tabindex="-1" role="listitem" id="wsoption-'+l+++'">'+this.getOptionContent(p)+"</li>";this.arrayOptions=g,this.popover.contentElement.html('<div class="datalist-box"><ul role="listbox">'+c.join("\n")+"</ul></div>"),t(this.input).removeAttr("aria-activedescendant").triggerHandler("datalistcreated",[{instance:this}]),e||this.popover.isVisible?(this.options.valueCompletion&&this.lastCompletedValue&&(h=t.prop(this.input,"value"))&&!h.indexOf(this.lastCompletedValue)&&(t.prop(this.input,"value",this.lastCompletedValue),t(this.input).triggerHandler("updateInput")),h!=this.lastCompletedValue&&(this.lastCompletedValue=""),this.showHideOptions()):(this.lastCompletedValue="",this.isCompleted=!1)},getOptionContent:function(e){var i,s=[{instance:this,item:e}];return(i=t(this.input).triggerHandler("getoptioncontent",s))&&i.indexOf&&-1==i.indexOf("option-value")&&(i+='<span class="option-value" style="display: none;">'+e.value+"</span>"),null==i&&(i='<span class="option-value">'+e.value+"</span>",e.label&&(i+=' <span class="option-label">'+e.label+"</span>")),i||""},setCompletedValue:function(e,i,s){if(this.isCompleted=!1,!this.options.valueCompletion||!i||this.lastCompletedValue.length>=e.length)this.lastCompletedValue=e;else{var a,o=this.input,l=t.prop(o,"selectionEnd");this.lastCompletedValue=e,e.length==l&&(a=e+i.value.substr(s.length),t(o).triggerHandler("triggerinput"),t.prop(o,"value",a),t(o).triggerHandler("updateInput"),t(o).callProp("setSelectionRange",[e.length,a.length]),setTimeout((function(){a==t.prop(o,"value")&&t.prop(o,"selectionEnd")!=a.length&&t.prop(o,"selectionEnd",a.length)}),0),this.isCompleted=!0)}},getPartialValue:function(){var e=t.prop(this.input,"value");return this.options.valueCompletion&&this.lastCompletedValue&&!t.prop(this.input,"value").indexOf(this.lastCompletedValue)&&(e=this.lastCompletedValue),this.options.multiple&&(e=(e=e.split(h))[e.length-1]||""),e},showHideOptions:function(e){var i,s,a=t.prop(this.input,"value"),o=a.toLowerCase(),l=!1,n="^"==this.options.filter,p=this;if(o!==this.lastUpdatedValue){if(this.options.multiple&&(o=(o=o.split(h))[o.length-1]||""),this.lastUnfoundValue&&0===o.indexOf(this.lastUnfoundValue))return void this.hideList();this.lastUpdatedValue=o,i=t("li",this.shadowList),o&&"!"!=this.options.filter?this.arrayOptions.forEach((function(e,a){var r,u,d;"lowerValue"in e||(e.lowerValue=e.value.toLowerCase(),e.label&&e.label!=e.value&&(e.lowerLabel=e.label.toLowerCase())),o!=e.lowerValue&&e.lowerLabel!=o&&(u=e.lowerValue.indexOf(o),(r=n?!u:-1!==u)?(d="value",s||u||(s=e)):e.lowerLabel&&(u=e.lowerLabel.indexOf(o),r=n?!u:-1!==u,d="label")),r?(p.addMark(t(i[a]).removeClass("hidden-item"),e,d,u,o.length),l=!0):t(i[a]).addClass("hidden-item")})):i.length&&(this.removeMark(i.removeClass("hidden-item")),l=!0),this.hasViewableData=l,!e&&l&&(this.popover.isVisible&&"bottom"==this.popover.element.attr("data-vertical")&&(p._stopMouseOver=!0,this.popover.element.triggerHandler("pospopover"),setTimeout((function(){p._stopMouseOver=!1}),9)),this.showList()),l?(t(this.input).removeAttr("aria-activedescendant"),this.setCompletedValue(a,s,o),this.lastUnfoundValue=!1):(this.lastUnfoundValue=o,this.hideList())}},otherType:{value:"label",label:"value"},addMark:function(e,i,s,a,o){if(this.options.highlight){var l=i[s].substr(a,o);l=i[s].replace(l,"<mark>"+l+"</mark>"),t(".option-"+this.otherType[s]+" > mark",e).each(this._replaceMark),t(".option-"+s,e).html(l)}},_replaceMark:function(){var e=t(this).html();t(this).replaceWith(e)},removeMark:function(e){this.options.highlight&&t("mark",e).each(this._replaceMark)},showList:function(){return!this.popover.isVisible&&(this.needsUpdate&&this.updateListOptions(),this.showHideOptions(!0),!!this.hasViewableData&&(this.shadowList.find("li.active-item").removeClass("active-item"),this.popover.show(this.input),t(this.input).attr({"aria-expanded":"true"}),!0))},hideList:function(){if(!this.popover.isVisible)return!1;var e=this;return t(this.input).attr({"aria-expanded":"false"}).removeAttr("aria-activedescendant"),this.popover.hide(),e.shadowList.removeClass("datalist-visible list-item-active"),e.index=-1,e.changedValue&&(e.triggeredByDatalist=!0,t(e.input).trigger("input").trigger("change"),e.changedValue=!1,e.triggeredByDatalist=!1),!0},scrollIntoView:function(e){var i,s=t("ul",this.shadowList),a=t("div.datalist-box",this.shadowList),o=e.position();return o.top-=(parseInt(s.css("paddingTop"),10)||0)+(parseInt(s.css("marginTop"),10)||0)+(parseInt(s.css("borderTopWidth"),10)||0),o.top<0?void a.scrollTop(a.scrollTop()+o.top-2):(o.top+=e.outerHeight(),i=a.height(),void(o.top>i&&a.scrollTop(a.scrollTop()+(o.top-i)+2)))},changeValue:function(e){if(e[0]){var i,s,a=t("span.option-value",e).text(),o=t.prop(this.input,"value");this.options.multiple&&((s=o.split(h))[s.length-1]=a,a=s.join(", ")),this.options.valueCompletion&&this.lastCompletedValue&&!o.indexOf(this.lastCompletedValue)&&(o=this.lastCompletedValue,this.lastCompletedValue=""),a!=o&&(t(this.input).prop("value",a).triggerHandler("updateInput"),this.changedValue=!0,(i=t.data(this.input,"wsspinner"))&&i.setInput&&i.setInput(a))}},markItem:function(e,i,s){var a;(s=s||t("li:not(.hidden-item)",this.shadowList)).length&&(0>e?e=s.length-1:e>=s.length&&(e=0),s.removeClass("active-item"),this.shadowList.addClass("list-item-active"),a=s.eq(e).addClass("active-item"),i&&("onlyScroll"!=i?this.changeValue(a):t(this.input).attr("aria-activedescendant",a.prop("id")),this.scrollIntoView(a)),this.index=e)}})}));
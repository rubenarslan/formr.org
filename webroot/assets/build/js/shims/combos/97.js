webshims.register("jmebase",(function(t,e,i,n,s){"use strict";var a={},r={},o=Array.prototype.slice,l=0,d=t.extend({selector:".mediaplayer"},e.cfg.mediaelement.jme),p=d.selector;e.cfg.mediaelement.jme=d,t.jme||(t.jme={}),t.extend(t.jme,{pluginsClasses:[],pluginsSel:"",plugins:{},props:a,fns:r,data:function(e,i,n){var a=t(e).data("jme")||t.data(e,"jme",{});return n===s?i?a[i]:a:void(a[i]=n)},runPlugin:function(e){l&&t(document.querySelectorAll(p)).each((function(){var i=this.querySelectorAll(e);i.length&&t(this).jmeFn("addControls",i)}))},registerPlugin:function(e,i){this.plugins[e]=i,i.nodeName||(i.nodeName=""),i.className||(i.className=e),this.pluginsClasses.push("."+i.className),this.pluginsSel=this.pluginsClasses.join(", "),d[e]=t.extend(i.options||{},d[e]),d[e]&&d[e].text?i.text=d[e].text:d.i18n&&d.i18n[e]&&(i.text=d.i18n[e]),this.runPlugin("."+i.className)},configmenuPlugins:{},addToConfigmenu:function(t,e){this.configmenuPlugins[t]=e},defineMethod:function(t,e){r[t]=e},defineProp:function(e,i){i||(i={}),i.set||(i.set=i.readonly?function(){throw e+" is readonly"}:t.noop),i.get||(i.get=function(i){return t.jme.data(i,e)}),a[e]=i},prop:function(e,i,n){if(!a[i])return t.prop(e,i,n);if(n===s)return a[i].get(e);var r=a[i].set(e,n);r===s&&(r=n),"noDataSet"!=r&&t.jme.data(e,i,r)}}),t.fn.jmeProp=function(e,i){return t.access(this,t.jme.prop,e,i,arguments.length>1)},t.fn.jmeFn=function(i){var n,a=o.call(arguments,1);return this.each((function(){return t.jme.data(this).media||(t(this).closest(p).jmePlayer(),e.warn("jmeFn called to early or on wrong element!")),(n=(r[i]||t.prop(this,i)).apply(this,a))===s&&void 0})),n!==s?n:this};var c={emptied:1,pause:1},u={canplay:1,canplaythrough:1};t.jme.initJME=function(e,i){l+=t(e.querySelectorAll(p)).add(i.filter(p)).jmePlayer().length},t.jme.getDOMList=function(e){var i=[];return e||(e=[]),"string"==typeof e&&(e=e.split(" ")),t.each(e,(function(t,e){e&&(e=document.getElementById(e))&&i.push(e)})),i},t.jme.getButtonText=function(e,i){var n,s;return e.is('[type="checkbox"], [type="radio"]')?(e.prop("checked",(function(){return this.defaultChecked})),n=!0):e.is("a")&&e.on("click",(function(t){t.preventDefault()})),function(a){s!==a&&(s=a,e.removeClass(i[a?0:1]).addClass(i[a]),n&&(e.prop("checked",!!a),(e.data("checkboxradio")||{refresh:t.noop}).refresh()))}},t.fn.jmePlayer=function(){return this.each((function(){var e,i,n,s,a,r,o=t("audio, video",this).eq(0),l=t(this),d=t.jme.data(this),p=t.jme.data(o[0]);l.addClass(o.prop("nodeName").toLowerCase()+"player"),p.player=l,p.media=o,d.media||(r=function(){l[0].className=l[0].className},n=function(){o.off("canplay",i),clearTimeout(s)},i=function(){var t=o.prop("paused")?"idle":"playing";l.attr("data-state",t)},e=function(e){var d,p,h=e.type;n(),u[h]&&"waiting"!=a||("ended"==h||t.prop(this,"ended")?h="ended":"waiting"==h?t.prop(this,"readyState")>2?h="":(s=setTimeout((function(){o.prop("readyState")>2&&i()}),9),o.on("canPlay",i)):c[h]?h="idle":(d=t.prop(this,"readyState"),h=!(p=t.prop(this,"paused"))&&3>d?"waiting":!p&&d>2?"playing":"idle"),"idle"==h&&l._seekpause&&(h=!1),h&&(a=h,l.attr("data-state",h),setTimeout(r)))},d.media=o,d.player=l,o.on("emptied waiting canplay canplaythrough playing ended pause mediaerror",e).on("volumechange updateJMEState",(function(){var e=t.prop(this,"volume");l[!e||t.prop(this,"muted")?"addClass":"removeClass"]("state-muted"),e=.01>e?"no":.36>e?"low":.7>e?"medium":"high",l.attr("data-volume",e)})),t.jme.pluginsSel&&l.jmeFn("addControls",t(l[0].querySelectorAll(t.jme.pluginsSel))),e&&o.on("updateJMEState",e).triggerHandler("updateJMEState"))}))},t.jme.defineProp("isPlaying",{get:function(e){return!t.prop(e,"ended")&&!t.prop(e,"paused")&&t.prop(e,"readyState")>1&&!t.data(e,"mediaerror")},readonly:!0}),t.jme.defineProp("player",{readonly:!0}),t.jme.defineProp("media",{readonly:!0}),t.jme.defineProp("srces",{get:function(e){var i=t.jme.data(e),n=i.media.prop("src");return n?[{src:n}]:t.map(t("source",i.media).get(),(function(e){var i,n,s={src:t.prop(e,"src")},a=e.attributes;for(i=0,n=a.length;n>i;i++)"specified"in a[i]&&!a[i].specified||(s[a[i].nodeName]=a[i].nodeValue);return s}))},set:function(e,i){var n=t.jme.data(e),s=function(e,i){"string"==typeof i&&(i={src:i}),t(document.createElement("source")).attr(i).appendTo(n.media)};return n.media.removeAttr("src").find("source").remove(),t.isArray(i)?t.each(i,s):s(0,i),n.media.jmeFn("load"),"noDataSet"}}),t.jme.defineMethod("togglePlay",(function(){t(this).jmeFn(a.isPlaying.get(this)?"pause":"play")})),t.jme.defineMethod("addControls",(function(e){var i=t.jme.data(this)||{};if(i.media){var n=t.jme.data(i.player[0],"controlElements")||t([]);e=t(e),t.jme.pluginsSel&&(e=e.find(t.jme.pluginsSel).add(e.filter(t.jme.pluginsSel))),e.length&&(t.each(t.jme.plugins,(function(n,s){var a,r,o,l,d=e.filter("."+s.className);for(o=0;o<d.length;o++)if(a=t(d[o]),(r=t.jme.data(d[o])).player=i.player,r.media=i.media,!r._rendered){if(r._rendered=!0,s.options)for(l in s.options)l in r||(r[l]=s.options[l]);s._create(a,i.media,i.player,r)}})),t.jme.data(i.player[0],"controlElements",n.add(e)),i.player.triggerHandler("controlsadded"))}})),e.ready("DOM mediaelement",(function(){e.isReady("jme",!0),e.addReady(t.jme.initJME),e.isReady("jme-base",!0),!1!==e.cfg.debug&&document.getElementsByTagName("video").length&&!document.querySelector(p)&&e.warn("found video element but video wasn't wrapped inside a ."+p+" element. Will not add control UI")}))})),webshims.ready("jme-base DOM",(function(){"use strict";function t(t){this._data=t,this.lists={},this.on("showcontrolschange",this._updateControlsClass)}function e(t,i,n){this.list=t||[],this.playlists=i,this.media=i._data.media,this.player=i._data.player,this.options=o.extend(!0,{},e.defaults,n),this.options.itemTmpl=this.options.itemTmpl.trim(),this.deferred=o.Deferred(),this._selectedIndex=-1,this._selectedItem=null,this.$rendered=null,this._detectListType(),this.autoplay(this.options.autoplay),this.deferred.done((function(){this._addEvents(this),"auto"!=this.options.defaultSelected||this.media.jmeProp("srces").length||(this.options.defaultSelected=0),this.list[this.options.defaultSelected]&&this.selectedIndex(this.options.defaultSelected),this._fire("addlist")}))}function i(t){return t.description=t.description||t.content,t.srces=[],(t.mediaGroups||[]).forEach((function(e){(e.contents||[]).forEach((function(e){e.src=e.src||e.url,t.srces.push(e)}))})),t}function n(){return{src:o.attr(this,"href"),srclang:o.attr(this,"lang"),label:o.attr(this,"data-label")}}function s(){return{src:o.attr(this,"url")||o.attr(this,"href"),type:o.attr(this,"type")}}function a(){return 1==this.nodeType}var r=window.webshims,o=r.$,l=o.jme,d=0;o.extend(t.prototype,{on:function(){o.fn.on.apply(o(this),arguments)},off:function(){o.fn.off.apply(o(this),arguments)},_getListId:function(t){return"string"==typeof t?t:t.id},_updateControlsClass:function(){this._data.player[this.getShowcontrolsList()?"addClass":"removeClass"]("has-playlist")},add:function(t,i){return(t=new e(t,this,i)).id||(d++,t.id="list-"+d),this.lists[t.id]=t,t.options.showcontrols&&this._data.player.addClass("has-playlist"),t},remove:function(t){var e=this._getListId(t);this.lists[e]&&(this.lists[e]._remove(),delete this.lists[e]),this.getShowcontrolsList()||this._data.player.removeClass("has-playlist")},getAutoplayList:function(){var t=null;return o.each(this.lists,(function(e,i){return i.options.autoplay?(t=i,!1):void 0})),t},getShowcontrolsList:function(){var t=null;return o.each(this.lists,(function(e,i){return i.options.showcontrols?(t=i,!1):void 0})),t}}),e.getText=function(t){return t.attr("content")||(t.text()||"").trim()},e.getUrl=function(t){return t.attr("content")||t.attr("url")||t.attr("href")||t.attr("src")||(t.text()||"").trim()},e.defaults={loop:!1,autoplay:!1,defaultSelected:"auto",addItemEvents:!0,showcontrols:!0,ajax:{},itemTmpl:'<li class="list-item"><% if(typeof poster == "string" && poster) {%><img src="<%=poster%>" /><% }%><h3><%=title%></h3><% if(typeof description == "string" && description) {%><div class="item-description"><%=description%></div><% }%></li>',renderer:function(t,e){return o.jme.tmpl(e,t)},mapDom:function(t){return{title:e.getText(o('[itemprop="name"], h1, h2, h3, h4, h5, h6, a',t)),srces:o('[itemprop="contentUrl"], a[type^="video"], a[type^="audio"]',t).map((function(){var i,n={src:e.getUrl(o(this))};return(i="a"==this.nodeName.toLowerCase()?o.prop(this,"type"):e.getText(o('[itemprop="encodingFormat"]',t)))&&(n.type=i),(i=o.attr(this,"data-media"))&&(n.media=i),n})).get(),tracks:o('a[type="text/vtt"]').map(n).get(),poster:e.getUrl(o('[itemprop="thumbnailUrl"], a[type^="image"], img',t))||null,description:e.getText(o('[itemprop="description"], .item-description, p',t))||null}},mapUrl:function(t,a){o.ajax(o.extend(t,{success:function(t){var r;o.isArray(t)?r=t:t.responseData&&t.responseData.feed?(t=t.responseData.feed,r=(t.entries||[]).map(i)):(r=[],o("item",t).each((function(){var t=o("enclosure, media\\:content",this).filter('[type^="video"], [type^="audio"]').map(s).get();t.length&&r.push({title:o("title",this).html(),srces:t,publishedDate:o("pubDate",this).html()||null,description:o("description",this).text()||null,poster:e.getUrl(o('itunes\\:image, media\\:thumbnail, enclosure[type^="image"], media\\:content[type^="image"]',this))||null,author:o("itunes\\:author",this).html()||null,duration:o("itunes\\:duration",this).html()||null,tracks:o("media\\:subTitle",this).map(n).get()||null})}))),r!=t&&(r.fullData=t),a(r)}}))}},o.extend(e.prototype,{on:function(){o.fn.on.apply(o(this),arguments)},off:function(){o.fn.off.apply(o(this),arguments)},_detectListType:function(){var t;return"string"==typeof this.list?void this._createListFromUrl():(this.list.nodeName||this.list.length>0&&this.list[0].nodeName?this._createListFromDom():this.list.responseData&&this.list.responseData.feed&&(t=this.list.responseData.feed,this.list=(t.entries||[]).map(i),this.list.fullData=t),void this.deferred.resolveWith(this))},_createListFromUrl:function(){var t=this;this.options.ajax.url=this.list,this.options.mapUrl(this.options.ajax,(function(e){t.list=e,t.deferred.resolveWith(t)}))},_createListFromDom:function(){var t=this;this.$rendered=o(this.list).eq(0),this.list=[],this.$rendered&&(this._addDomList(),this.list=this.$rendered.children().map((function(){return t._createItemFromDom(this)})).get())},_createItemFromDom:function(t){var e=this.options.mapDom(t);return this._addItemData(e,t),e},_fire:function(t,e){t=o.Event(t),o(this).triggerHandler(t,e),o(this.playlists).triggerHandler(t,o.merge([{list:this}],e||[])),this.$rendered&&this.$rendered.triggerHandler(t,e)},_addDomList:function(){this.$rendered.attr({"data-autoplay":this.options.autoplay,"data-loop":this.options.loop}).addClass("media-playlist").data("playlist",this)},_addItemData:function(t,e){var i=this;t.$item=o(e).data("itemData",t),t==this._selectedItem&&t.$item.addClass("selected-item"),this.options.addItemEvents&&t.$item.on("click.playlist",(function(e){return i.options.addItemEvents?(i.playItem(t,e),!1):void 0}))},_addEvents:function(t){var e=t.options,i=function(i){e.autoplay&&t.playNext(i)};this.media.on("ended",i),this._remove=function(){t.media.off("ended",i),t.autoplay(!1),t.$rendered&&t.$rendered.remove(),t._fire("removelist")}},_remove:function(){this._fire("removelist")},render:function(t){this.$rendered?t(this.$rendered,this.player,this):this.deferred.done((function(){var e=this,i=[];if(!this.$rendered){switch(o.each(this.list,(function(t,n){var s=o(o.parseHTML(e.options.renderer(n,e.options.itemTmpl))).filter(a)[0];e._addItemData(n,s),i.push(s)})),(i[0]&&i[0].nodeName||"").toLowerCase()){case"li":this.$rendered=o.parseHTML("<ul />");break;case"option":this.$rendered=o.parseHTML("<select />");break;default:this.$rendered=o.parseHTML("<div />")}this.$rendered=o(this.$rendered).html(i),this._addDomList()}t(this.$rendered,this.player,this)}))},_loadItem:function(t){var e=this.media;e.attr("poster",t.poster||""),o("track",e).remove(),o.each(t.tracks||[],(function(t,i){o("<track />").attr(i).appendTo(e)})),t.srces||(t.srces=t),e.jmeProp("srces",t.srces)},_getItem:function(t){return t&&(t.nodeName||t.jquery||"string"==typeof t)&&(t=o(t).data("itemData")),t},playItem:function(t,e){var i;this.selectedItem(t,e),t&&(i=this.media.play(),setTimeout((function(){i.play()}),9))},selectedIndex:function(t,e){return arguments.length?void this.selectedItem(this.list[t],e):this._selectedIndex},selectedItem:function(t,e){var i,n;return arguments.length?(n=-1,(t=this._getItem(t))&&o.each(this.list,(function(e){return t==this?(n=e,!1):void 0})),n>=0&&this._loadItem(this.list[n]),void(n!=this._selectedIndex&&(i=this._selectedItem||null,i&&i.$item&&i.$item.removeClass("selected-item"),this._selectedItem=this.list[n]||null,this._selectedIndex=n,this._selectedItem&&this._selectedItem.$item&&this._selectedItem.$item.addClass("selected-item"),i!==this._selectedItem&&this._fire("itemchange",[{oldItem:i,from:e||null}])))):this._selectedItem},playNext:function(){var t=this.getNext();t&&this.playItem(t)},playPrev:function(){var t=this.getPrev();t&&this.playItem(t)},getNext:function(){var t=this._selectedIndex+1;return this.list[t]||(this.options.loop?this.list[0]:null)},getPrev:function(){var t=this._selectedIndex-1;return this.list[t]||(this.options.loop?this.list[this.list.length-1]:null)}}),[{name:"autoplay",fn:"getAutoplayList"},{name:"showcontrols",fn:"getShowcontrolsList"},{name:"loop"}].forEach((function(t){e.prototype[t.name]=function(e){var i;return arguments.length?((e=!!e)&&t.fn&&(i=this.playlists[t.fn]())&&i!=this&&i[t.name](!1),void(this.options[t.name]!=e&&(this.options[t.name]=e,this.$rendered&&this.$rendered.attr("data-"+t.name,e),this._fire(t.name+"change")))):this.options[t.name]}})),l.defineProp("playlists",{writable:!1,get:function(e){var i=o.jme.data(e);return e!=i.player[0]?null:(i.playlists||(i.playlists=new t(i)),i.playlists)}}),l.defineMethod("addPlaylist",(function(t,e){var i=o.jme.prop(this,"playlists");return i&&i.add?i.add(t,e):null})),[{name:"playlist-prev",text:"previous",get:"getPrev",play:"playPrev"},{name:"playlist-next",text:"next",get:"getNext",play:"playNext"}].forEach((function(t){o.jme.registerPlugin(t.name,{structure:'<button class="{%class%}" type="button" aria-label="{%text%}"></button>',text:t.text,_create:function(e,i,n){function s(){var i=r[t.get]();e.prop(i?{disabled:!1,title:i.title}:{disabled:!0,title:""})}function a(){var t=o.getShowcontrolsList();t!=r&&(r&&r.off("itemchange",s),(r=t)&&(r.on("itemchange",s),s()))}var r,o=n.jmeProp("playlists");e.on("click",(function(){r&&r[t.play]()})),o.on({"addlist removelist showcontrolschange":a}),a()}})})),function(){var t={};o.jme.tmpl=function(e,i){return t[e]||(t[e]=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');")),i?t[e](i):t[e]}}(),o.jme.Playlist=e,r.isReady("playlist",!0)}));
webshims.ready("jme-base DOM",(function(){"use strict";function t(t){this._data=t,this.lists={},this.on("showcontrolschange",this._updateControlsClass)}function e(t,i,s){this.list=t||[],this.playlists=i,this.media=i._data.media,this.player=i._data.player,this.options=o.extend(!0,{},e.defaults,s),this.options.itemTmpl=this.options.itemTmpl.trim(),this.deferred=o.Deferred(),this._selectedIndex=-1,this._selectedItem=null,this.$rendered=null,this._detectListType(),this.autoplay(this.options.autoplay),this.deferred.done((function(){this._addEvents(this),"auto"!=this.options.defaultSelected||this.media.jmeProp("srces").length||(this.options.defaultSelected=0),this.list[this.options.defaultSelected]&&this.selectedIndex(this.options.defaultSelected),this._fire("addlist")}))}function i(t){return t.description=t.description||t.content,t.srces=[],(t.mediaGroups||[]).forEach((function(e){(e.contents||[]).forEach((function(e){e.src=e.src||e.url,t.srces.push(e)}))})),t}function s(){return{src:o.attr(this,"href"),srclang:o.attr(this,"lang"),label:o.attr(this,"data-label")}}function n(){return{src:o.attr(this,"url")||o.attr(this,"href"),type:o.attr(this,"type")}}function r(){return 1==this.nodeType}var a=window.webshims,o=a.$,l=o.jme,d=0;o.extend(t.prototype,{on:function(){o.fn.on.apply(o(this),arguments)},off:function(){o.fn.off.apply(o(this),arguments)},_getListId:function(t){return"string"==typeof t?t:t.id},_updateControlsClass:function(){this._data.player[this.getShowcontrolsList()?"addClass":"removeClass"]("has-playlist")},add:function(t,i){return(t=new e(t,this,i)).id||(d++,t.id="list-"+d),this.lists[t.id]=t,t.options.showcontrols&&this._data.player.addClass("has-playlist"),t},remove:function(t){var e=this._getListId(t);this.lists[e]&&(this.lists[e]._remove(),delete this.lists[e]),this.getShowcontrolsList()||this._data.player.removeClass("has-playlist")},getAutoplayList:function(){var t=null;return o.each(this.lists,(function(e,i){return i.options.autoplay?(t=i,!1):void 0})),t},getShowcontrolsList:function(){var t=null;return o.each(this.lists,(function(e,i){return i.options.showcontrols?(t=i,!1):void 0})),t}}),e.getText=function(t){return t.attr("content")||(t.text()||"").trim()},e.getUrl=function(t){return t.attr("content")||t.attr("url")||t.attr("href")||t.attr("src")||(t.text()||"").trim()},e.defaults={loop:!1,autoplay:!1,defaultSelected:"auto",addItemEvents:!0,showcontrols:!0,ajax:{},itemTmpl:'<li class="list-item"><% if(typeof poster == "string" && poster) {%><img src="<%=poster%>" /><% }%><h3><%=title%></h3><% if(typeof description == "string" && description) {%><div class="item-description"><%=description%></div><% }%></li>',renderer:function(t,e){return o.jme.tmpl(e,t)},mapDom:function(t){return{title:e.getText(o('[itemprop="name"], h1, h2, h3, h4, h5, h6, a',t)),srces:o('[itemprop="contentUrl"], a[type^="video"], a[type^="audio"]',t).map((function(){var i,s={src:e.getUrl(o(this))};return(i="a"==this.nodeName.toLowerCase()?o.prop(this,"type"):e.getText(o('[itemprop="encodingFormat"]',t)))&&(s.type=i),(i=o.attr(this,"data-media"))&&(s.media=i),s})).get(),tracks:o('a[type="text/vtt"]').map(s).get(),poster:e.getUrl(o('[itemprop="thumbnailUrl"], a[type^="image"], img',t))||null,description:e.getText(o('[itemprop="description"], .item-description, p',t))||null}},mapUrl:function(t,r){o.ajax(o.extend(t,{success:function(t){var a;o.isArray(t)?a=t:t.responseData&&t.responseData.feed?(t=t.responseData.feed,a=(t.entries||[]).map(i)):(a=[],o("item",t).each((function(){var t=o("enclosure, media\\:content",this).filter('[type^="video"], [type^="audio"]').map(n).get();t.length&&a.push({title:o("title",this).html(),srces:t,publishedDate:o("pubDate",this).html()||null,description:o("description",this).text()||null,poster:e.getUrl(o('itunes\\:image, media\\:thumbnail, enclosure[type^="image"], media\\:content[type^="image"]',this))||null,author:o("itunes\\:author",this).html()||null,duration:o("itunes\\:duration",this).html()||null,tracks:o("media\\:subTitle",this).map(s).get()||null})}))),a!=t&&(a.fullData=t),r(a)}}))}},o.extend(e.prototype,{on:function(){o.fn.on.apply(o(this),arguments)},off:function(){o.fn.off.apply(o(this),arguments)},_detectListType:function(){var t;return"string"==typeof this.list?void this._createListFromUrl():(this.list.nodeName||this.list.length>0&&this.list[0].nodeName?this._createListFromDom():this.list.responseData&&this.list.responseData.feed&&(t=this.list.responseData.feed,this.list=(t.entries||[]).map(i),this.list.fullData=t),void this.deferred.resolveWith(this))},_createListFromUrl:function(){var t=this;this.options.ajax.url=this.list,this.options.mapUrl(this.options.ajax,(function(e){t.list=e,t.deferred.resolveWith(t)}))},_createListFromDom:function(){var t=this;this.$rendered=o(this.list).eq(0),this.list=[],this.$rendered&&(this._addDomList(),this.list=this.$rendered.children().map((function(){return t._createItemFromDom(this)})).get())},_createItemFromDom:function(t){var e=this.options.mapDom(t);return this._addItemData(e,t),e},_fire:function(t,e){t=o.Event(t),o(this).triggerHandler(t,e),o(this.playlists).triggerHandler(t,o.merge([{list:this}],e||[])),this.$rendered&&this.$rendered.triggerHandler(t,e)},_addDomList:function(){this.$rendered.attr({"data-autoplay":this.options.autoplay,"data-loop":this.options.loop}).addClass("media-playlist").data("playlist",this)},_addItemData:function(t,e){var i=this;t.$item=o(e).data("itemData",t),t==this._selectedItem&&t.$item.addClass("selected-item"),this.options.addItemEvents&&t.$item.on("click.playlist",(function(e){return i.options.addItemEvents?(i.playItem(t,e),!1):void 0}))},_addEvents:function(t){var e=t.options,i=function(i){e.autoplay&&t.playNext(i)};this.media.on("ended",i),this._remove=function(){t.media.off("ended",i),t.autoplay(!1),t.$rendered&&t.$rendered.remove(),t._fire("removelist")}},_remove:function(){this._fire("removelist")},render:function(t){this.$rendered?t(this.$rendered,this.player,this):this.deferred.done((function(){var e=this,i=[];if(!this.$rendered){switch(o.each(this.list,(function(t,s){var n=o(o.parseHTML(e.options.renderer(s,e.options.itemTmpl))).filter(r)[0];e._addItemData(s,n),i.push(n)})),(i[0]&&i[0].nodeName||"").toLowerCase()){case"li":this.$rendered=o.parseHTML("<ul />");break;case"option":this.$rendered=o.parseHTML("<select />");break;default:this.$rendered=o.parseHTML("<div />")}this.$rendered=o(this.$rendered).html(i),this._addDomList()}t(this.$rendered,this.player,this)}))},_loadItem:function(t){var e=this.media;e.attr("poster",t.poster||""),o("track",e).remove(),o.each(t.tracks||[],(function(t,i){o("<track />").attr(i).appendTo(e)})),t.srces||(t.srces=t),e.jmeProp("srces",t.srces)},_getItem:function(t){return t&&(t.nodeName||t.jquery||"string"==typeof t)&&(t=o(t).data("itemData")),t},playItem:function(t,e){var i;this.selectedItem(t,e),t&&(i=this.media.play(),setTimeout((function(){i.play()}),9))},selectedIndex:function(t,e){return arguments.length?void this.selectedItem(this.list[t],e):this._selectedIndex},selectedItem:function(t,e){var i,s;return arguments.length?(s=-1,(t=this._getItem(t))&&o.each(this.list,(function(e){return t==this?(s=e,!1):void 0})),s>=0&&this._loadItem(this.list[s]),void(s!=this._selectedIndex&&(i=this._selectedItem||null,i&&i.$item&&i.$item.removeClass("selected-item"),this._selectedItem=this.list[s]||null,this._selectedIndex=s,this._selectedItem&&this._selectedItem.$item&&this._selectedItem.$item.addClass("selected-item"),i!==this._selectedItem&&this._fire("itemchange",[{oldItem:i,from:e||null}])))):this._selectedItem},playNext:function(){var t=this.getNext();t&&this.playItem(t)},playPrev:function(){var t=this.getPrev();t&&this.playItem(t)},getNext:function(){var t=this._selectedIndex+1;return this.list[t]||(this.options.loop?this.list[0]:null)},getPrev:function(){var t=this._selectedIndex-1;return this.list[t]||(this.options.loop?this.list[this.list.length-1]:null)}}),[{name:"autoplay",fn:"getAutoplayList"},{name:"showcontrols",fn:"getShowcontrolsList"},{name:"loop"}].forEach((function(t){e.prototype[t.name]=function(e){var i;return arguments.length?((e=!!e)&&t.fn&&(i=this.playlists[t.fn]())&&i!=this&&i[t.name](!1),void(this.options[t.name]!=e&&(this.options[t.name]=e,this.$rendered&&this.$rendered.attr("data-"+t.name,e),this._fire(t.name+"change")))):this.options[t.name]}})),l.defineProp("playlists",{writable:!1,get:function(e){var i=o.jme.data(e);return e!=i.player[0]?null:(i.playlists||(i.playlists=new t(i)),i.playlists)}}),l.defineMethod("addPlaylist",(function(t,e){var i=o.jme.prop(this,"playlists");return i&&i.add?i.add(t,e):null})),[{name:"playlist-prev",text:"previous",get:"getPrev",play:"playPrev"},{name:"playlist-next",text:"next",get:"getNext",play:"playNext"}].forEach((function(t){o.jme.registerPlugin(t.name,{structure:'<button class="{%class%}" type="button" aria-label="{%text%}"></button>',text:t.text,_create:function(e,i,s){function n(){var i=a[t.get]();e.prop(i?{disabled:!1,title:i.title}:{disabled:!0,title:""})}function r(){var t=o.getShowcontrolsList();t!=a&&(a&&a.off("itemchange",n),(a=t)&&(a.on("itemchange",n),n()))}var a,o=s.jmeProp("playlists");e.on("click",(function(){a&&a[t.play]()})),o.on({"addlist removelist showcontrolschange":r}),r()}})})),function(){var t={};o.jme.tmpl=function(e,i){return t[e]||(t[e]=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');")),i?t[e](i):t[e]}}(),o.jme.Playlist=e,a.isReady("playlist",!0)}));